<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
  <script src="https://unpkg.com/@trevoreyre/autocomplete-js"></script>
  <link rel="stylesheet" href="https://unpkg.com/@trevoreyre/autocomplete-js/dist/style.css">
  <!--<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>-->

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
	  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
	  crossorigin="anonymous"></script>

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

  <script src="js/fisheye.js"></script>
  <script src="js/phylo_tree.js"></script>
  <script src="js/index.js"></script>

  <link rel="stylesheet"  href="css/index.css"></link>

  <title>ENDSPE</title>
</head>

<body>

  <header class="hero">
    <div class="hero-head">
      <nav class="navbar has-shadow" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">

          <a class="navbar-item is-tab is-hidden-mobile">ENDSPE Visualization</a>
          <a class="navbar-item is-tab is-hidden-mobile" href="about.html">About</a>

        </div>


        <div class="navbar-menu navbar-end" id="navMenu">
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              Display
            </a>

            <div class="navbar-dropdown is-right">
                <a class="navbar-item display_animal">
                  Animals
                </a>
                <hr class="navbar-divider">
                <a class="navbar-item display_plant">
                  Plants
                </a>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <div class="wrapper">
    <div class="columns" style="margin-top: 0px; margin-bottom: 0px;">
      <aside class="column is-2 aside" style="background-color: #f2ffe6">
        <nav class="menu">
          <p class="menu-label" id="left-bar-title">
            Reign
          </p>
          <ul class="menu-list">
            <li><a class="display_animal">Animals</a></li>
            <li><a class="display_plant">Plants</a></li>
          </ul>
          <p class="menu-label" id="left-bar-title">
            Parameters
          </p>
          <ul class="menu-list">
            <div id="autocomplete" class="autocomplete">
              <input class="autocomplete-input" placeholder="Search species or rank">
              <ul class="autocomplete-result-list"></ul>
            </div>

          </ul>
        </nav>
      </aside>
      <div class="column">
        <div class="container">
          <svg width="960" height="900"></svg>
          <script>
            var currentReignUrl = localStorage.getItem("current-reign-url") || "https://raw.githubusercontent.com/ddonatien/endspe/master/app/data/phylo_animal_2.csv";
            phyloTree(currentReignUrl);
          </script>
        </div>
      </div>
      <div class="column">
        <img id="illustration" width="200vh"/>
        <p class="menu-label" style="margin-top: 3vh">
          Wikipedia
        </p>
        <span id="thlevel"style="opacity: 0.8; visibility: hidden;">Threat level : 
        <svg height="1vh"></svg></span>
        <div id="wiki" class="container" style="height: 50%; margin-right: 10px">
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="content has-text-centered">
      <p>
        <strong>ENDSPE Project</strong> hosted on <a href="https://github.com/ddonatien/endspe">Github</a>. Made in a <a href="https://github.com/LyonDataViz/MOS5.5-Dataviz">Data Visualization course</a> at the <a href="https://www.ec-lyon.fr/">Ecole Centrale de Lyon</a>.
      </p>
    </div>
  </footer>

  <!-- <script>
  jQuery($ => {
    // var phyloDatas = loadCSV("https://github.com/ddonatien/endspe/blob/master/app/data/phylo.csv");
    // console.log(phyloDatas);

    //var phyloItems = JSON.parse('{{itemList | tojson | safe}}');

    var items = ["Animalia", "PLANTAE", "CHORDIA"];
    //phyloItems.forEach(item => items.push(item))

    new Autocomplete('#autocomplete', {
      search: input => {
        if (input.length < 1) { return [] }
        var items1 = items.filter(title => {
          return title.toLowerCase()
            .startsWith(input.toLowerCase())
        });
        var items2 = [];
        if (input.length >= 3){
            items2 = items.filter(title => {
              return (
                title.toLowerCase()
                .includes(input.toLowerCase())) &&
                (!(title.toLowerCase()
                .startsWith(input.toLowerCase())))
            });
        }
        return items1.concat(items2)
      },
      onSubmit: result => {

        let url=`https://en.wikipedia.org/w/api.php?origin=*&action=opensearch&prop=extracts&exintro=&search=${result}&format=json`;
        Http.open("GET", url, true);
        Http.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
        Http.responseType = 'json';
        Http.send();

        Http.onreadystatechange = (e) => {
        let pageTitle = Http.response[1][0];
        let wikiUrl = Http.response[3][0];
        let url=`https://en.wikipedia.org/w/api.php?origin=*&action=query&prop=extracts&exintro=&titles=${pageTitle}&format=json`;
        Http.open("GET", url, true);
        Http.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
        Http.responseType = 'json';
        Http.send();

        Http.onreadystatechange = (e) => {
              let pages = Http.response.query.pages;
              let key = Object.keys(pages)[0];
              if (key) {
            if (pages[key].extract) {
              $("#wiki").append(pages[key].extract);
            }
            else {
              $("#wiki").append("<p>No wikipedia extract :(</p><br>");
            }
            $("#wiki").append("<a href='" + wikiUrl + "'>Wiki link</a>");

            let url=`https://en.wikipedia.org/w/api.php?origin=*&action=query&prop=images&titles=${pageTitle}&format=json`;
            Http.open("GET", url, true);
            Http.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            Http.responseType = 'json';
            Http.send();

            Http.onreadystatechange = (e) => {
              let images = Http.response.query.pages[key].images[0].title.replace('File:', '');
              let url=`https://en.wikipedia.org/w/api.php?origin=*&action=query&titles=Image:${images}&format=json&prop=imageinfo&iiprop=url`;
              Http.open("GET", url, true);
              Http.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
              Http.responseType = 'json';
              Http.send();

              Http.onreadystatechange = (e) => {
                let ipages = Http.response.query.pages;
                let ikey = Object.keys(ipages)[0];
                let imurl = ipages[ikey].imageinfo[0].url;
                if (imurl) {
                  $("#illustration").append("<img src='" + imurl + "'/>") ;
                      }
                    }
                  }
              }
              else {
                $("#wiki").append("<p>No wikipedia page found :(</p>");
              }
        }
        }}
    })

      
    function loadCSV(url) {
      var data;
      
      $.ajax({
        type: "GET",  
        url: url,
        dataType: "text",       
        success: function(response)  
        {
        data = $.csv.toArrays(response);
        }   
      });

      return data
    }
  })
  </script> -->

</body>
